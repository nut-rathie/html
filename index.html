<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Linux Distro Popularity Explorer</title>
  <style>
    :root {
      color-scheme: light dark;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
      --bg: linear-gradient(160deg, #f8fbff 0%, #eef4ff 50%, #dde7ff 100%);
      --card-bg: rgba(255, 255, 255, 0.85);
      --border: rgba(37, 99, 235, 0.12);
      --primary: #2563eb;
      --primary-soft: rgba(37, 99, 235, 0.12);
      --text: #0f172a;
      --muted: #475569;
      --positive: #0d9488;
      --negative: #dc2626;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 3rem 1.25rem 4rem;
    }

    .app {
      width: min(1100px, 100%);
      display: flex;
      flex-direction: column;
      gap: 2.5rem;
    }

    .hero {
      background: var(--card-bg);
      padding: 2.5rem;
      border-radius: 1.75rem;
      box-shadow: 0 1.5rem 3rem rgba(15, 23, 42, 0.12);
      backdrop-filter: blur(8px);
    }

    .hero h1 {
      margin: 0 0 0.75rem;
      font-size: clamp(2.2rem, 3vw, 2.8rem);
      letter-spacing: -0.02em;
    }

    .hero p {
      margin: 0;
      max-width: 60ch;
      line-height: 1.65;
      color: var(--muted);
    }

    .hero-meta {
      margin-top: 1.5rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem 2rem;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .hero-meta span::before {
      content: "";
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 999px;
      margin-right: 0.5rem;
      background: var(--primary);
      opacity: 0.5;
      vertical-align: middle;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      align-items: center;
      background: var(--card-bg);
      padding: 1.5rem 2rem;
      border-radius: 1.5rem;
      box-shadow: 0 1.25rem 2.5rem rgba(15, 23, 42, 0.1);
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      flex: 1 1 200px;
      font-size: 0.95rem;
    }

    .control-group label {
      font-weight: 600;
      color: var(--muted);
    }

    .control-group input,
    .control-group select {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid var(--border);
      border-radius: 0.9rem;
      padding: 0.7rem 1rem;
      font-size: 1rem;
      color: inherit;
      box-shadow: inset 0 1px 3px rgba(15, 23, 42, 0.04);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 2rem;
    }

    .panel {
      background: var(--card-bg);
      padding: 1.75rem 2rem;
      border-radius: 1.5rem;
      box-shadow: 0 1.5rem 3rem rgba(15, 23, 42, 0.15);
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .panel h2 {
      margin: 0 0 1rem;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .panel h2 span {
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--primary);
      background: var(--primary-soft);
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
    }

    .table-wrapper {
      overflow: auto;
      border-radius: 1rem;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.75);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 620px;
    }

    thead {
      background: rgba(37, 99, 235, 0.08);
      color: var(--muted);
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.08em;
    }

    th, td {
      padding: 0.85rem 1rem;
      text-align: left;
      border-bottom: 1px solid rgba(15, 23, 42, 0.05);
    }

    tbody tr {
      transition: background 0.2s ease, transform 0.2s ease;
      cursor: pointer;
    }

    tbody tr:hover {
      background: rgba(37, 99, 235, 0.08);
      transform: translateX(4px);
    }

    tbody tr.selected {
      background: rgba(37, 99, 235, 0.13);
      box-shadow: inset 2px 0 0 0 var(--primary);
    }

    .distro-name {
      font-weight: 600;
      font-size: 1rem;
    }

    .metric strong {
      font-size: 1.05rem;
    }

    .metric small {
      display: block;
      color: var(--muted);
      font-size: 0.8rem;
      margin-top: 0.2rem;
    }

    .change {
      font-weight: 600;
      display: flex;
      gap: 0.3rem;
      align-items: baseline;
    }

    .change.positive {
      color: var(--positive);
    }

    .change.negative {
      color: var(--negative);
    }

    .momentum {
      font-weight: 600;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .momentum span {
      font-size: 0.85rem;
      color: var(--muted);
      opacity: 0.75;
    }

    .detail-header {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      margin-bottom: 1.5rem;
    }

    .detail-header h3 {
      margin: 0;
      font-size: 1.8rem;
      letter-spacing: -0.01em;
    }

    .detail-header p {
      margin: 0;
      color: var(--muted);
      line-height: 1.6;
    }

    .detail-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .detail-card {
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1rem 1.25rem;
      background: rgba(255, 255, 255, 0.8);
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .detail-card span {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    .detail-card strong {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .chart {
      flex: 1;
      border: 1px solid var(--border);
      border-radius: 1.25rem;
      padding: 1.25rem;
      background: rgba(255, 255, 255, 0.85);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .chart header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 0.95rem;
      color: var(--muted);
    }

    svg {
      width: 100%;
      height: auto;
      max-height: 260px;
    }

    .trend-line {
      fill: none;
      stroke: var(--primary);
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .trend-area {
      fill: url(#lineGradient);
      stroke: none;
    }

    .chart circle {
      fill: #1d4ed8;
      stroke: #fff;
      stroke-width: 2;
    }

    .grid-line {
      stroke: rgba(148, 163, 184, 0.35);
      stroke-dasharray: 4 6;
    }

    .axis {
      stroke: rgba(15, 23, 42, 0.18);
      stroke-width: 1.5;
    }

    .tick-label {
      font-size: 0.75rem;
      fill: var(--muted);
    }

    .empty-state {
      text-align: center;
      padding: 2rem;
      color: var(--muted);
    }

    @media (max-width: 960px) {
      body {
        padding: 2.5rem 1rem 3rem;
      }

      .layout {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      .hero, .controls, .panel {
        padding: 1.75rem;
      }

      .control-group {
        flex: 1 1 100%;
      }

      table {
        min-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="hero">
      <h1>Linux Distro Popularity Explorer</h1>
      <p>
        Track which Linux distributions have captured the most attention across 2025 to date
        (Jan&nbsp;1 through Oct&nbsp;18). Filter the rankings, sort by the metric you care about,
        and inspect monthly page-hit trends to understand momentum at a glance.
      </p>
      <div class="hero-meta" id="hero-meta"></div>
    </header>

    <section class="controls" aria-label="Filter and sort options">
      <div class="control-group">
        <label for="search">Search distributions</label>
        <input id="search" type="search" placeholder="Type a distro name (e.g. \"Fedora\")" autocomplete="off">
      </div>
      <div class="control-group">
        <label for="sort">Sort by</label>
        <select id="sort">
          <option value="avgHits">Average page hits</option>
          <option value="lastHits">Latest month hits</option>
          <option value="change">YTD change</option>
          <option value="trend">Last month momentum</option>
        </select>
      </div>
    </section>

    <div class="layout">
      <section class="panel" aria-labelledby="table-heading">
        <h2 id="table-heading">Page-hit rankings <span>2025 YTD</span></h2>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Distribution</th>
                <th scope="col">Avg hits</th>
                <th scope="col">Latest month</th>
                <th scope="col">YTD change</th>
                <th scope="col">Momentum</th>
              </tr>
            </thead>
            <tbody id="distros-body"></tbody>
          </table>
          <div class="empty-state" id="empty-state" hidden>No distributions match your filters.</div>
        </div>
      </section>

      <aside class="panel" aria-live="polite">
        <div class="detail-header">
          <h3 id="detail-name">Select a distribution</h3>
          <p id="detail-description">Choose a distro from the table to inspect page-hit momentum month-by-month.</p>
        </div>
        <div class="detail-metrics" id="detail-metrics" hidden>
          <article class="detail-card">
            <span>Average hits</span>
            <strong id="detail-average">-</strong>
            <small id="detail-average-note"></small>
          </article>
          <article class="detail-card">
            <span>Latest month</span>
            <strong id="detail-latest">-</strong>
            <small id="detail-latest-note"></small>
          </article>
          <article class="detail-card">
            <span>YTD change</span>
            <strong id="detail-change">-</strong>
            <small id="detail-change-note"></small>
          </article>
        </div>
        <div class="chart" id="chart-container" hidden>
          <header>
            <span>Monthly page hits</span>
            <span id="chart-range"></span>
          </header>
          <svg id="trend-chart" viewBox="0 0 360 220" role="img" aria-label="Distribution trend"></svg>
        </div>
      </aside>
    </div>
  </div>

  <script>
    const state = {
      months: [],
      distros: [],
      filter: '',
      sortKey: 'avgHits',
      selected: null
    };

    const heroMetaEl = document.getElementById('hero-meta');
    const searchEl = document.getElementById('search');
    const sortEl = document.getElementById('sort');
    const tableBodyEl = document.getElementById('distros-body');
    const emptyStateEl = document.getElementById('empty-state');

    const detailNameEl = document.getElementById('detail-name');
    const detailDescriptionEl = document.getElementById('detail-description');
    const detailMetricsEl = document.getElementById('detail-metrics');
    const chartContainerEl = document.getElementById('chart-container');
    const detailAverageEl = document.getElementById('detail-average');
    const detailAverageNoteEl = document.getElementById('detail-average-note');
    const detailLatestEl = document.getElementById('detail-latest');
    const detailLatestNoteEl = document.getElementById('detail-latest-note');
    const detailChangeEl = document.getElementById('detail-change');
    const detailChangeNoteEl = document.getElementById('detail-change-note');
    const chartRangeEl = document.getElementById('chart-range');
    const chartEl = document.getElementById('trend-chart');

    fetch('data/distros.json')
      .then(response => {
        if (!response.ok) {
          throw new Error('Unable to load distro data');
        }
        return response.json();
      })
      .then(initialData => {
        hydrateState(initialData);
        renderHeroMeta(initialData.metadata);
        renderTable();
        if (state.distros.length) {
          setSelected(state.distros[0].name);
        }
      })
      .catch(error => {
        heroMetaEl.innerHTML = `<span>${error.message}</span>`;
      });

    function hydrateState(data) {
      state.months = data.months.map(month => month.label);
      const series = new Map();

      data.months.forEach(month => {
        month.distros.forEach(entry => {
          if (!series.has(entry.name)) {
            series.set(entry.name, []);
          }
          series.get(entry.name).push({ label: month.label, hits: entry.hits });
        });
      });

      state.distros = Array.from(series.entries()).map(([name, points]) => {
        const hits = points.map(point => point.hits);
        const sum = hits.reduce((total, value) => total + value, 0);
        const avgHits = sum / hits.length;
        const lastHits = hits[hits.length - 1];
        const firstHits = hits[0];
        const change = lastHits - firstHits;
        const changePct = firstHits ? (change / firstHits) * 100 : 0;
        const trend = hits.length > 1 ? lastHits - hits[hits.length - 2] : 0;

        return {
          name,
          points,
          avgHits,
          lastHits,
          firstHits,
          change,
          changePct,
          trend
        };
      });
    }

    function renderHeroMeta(metadata = {}) {
      const parts = [];
      if (metadata.span) {
        parts.push(`Covering: <strong>${metadata.span}</strong>`);
      }
      if (state.months.length) {
        const first = state.months[0];
        const last = state.months[state.months.length - 1];
        parts.push(`Range: <strong>${first}</strong> – <strong>${last}</strong>`);
      }
      if (metadata.source) {
        parts.push(`Source: <strong>${metadata.source}</strong>`);
      }

      heroMetaEl.innerHTML = parts.map(text => `<span>${text}</span>`).join('');
    }

    function renderTable() {
      const rows = getFilteredDistros();
      if (!rows.length) {
        tableBodyEl.innerHTML = '';
        emptyStateEl.hidden = false;
        return;
      }

      emptyStateEl.hidden = true;
      tableBodyEl.innerHTML = rows
        .map((distro, index) => {
          const rank = index + 1;
          const isSelected = state.selected && state.selected.name === distro.name;
          const trendIcon = distro.trend > 0 ? '▲' : distro.trend < 0 ? '▼' : '◼';
          const trendClass = distro.trend > 0 ? 'positive' : distro.trend < 0 ? 'negative' : '';
          const changeClass = distro.change >= 0 ? 'positive' : 'negative';

          return `
            <tr data-name="${distro.name}" class="${isSelected ? 'selected' : ''}">
              <td>${rank.toString().padStart(2, '0')}</td>
              <td><span class="distro-name">${distro.name}</span></td>
              <td class="metric">
                <strong>${formatNumber(distro.avgHits)}</strong>
                <small>avg hits / day</small>
              </td>
              <td class="metric">
                <strong>${formatNumber(distro.lastHits)}</strong>
                <small>${state.months[state.months.length - 1]}</small>
              </td>
              <td class="change ${changeClass}">
                ${formatSigned(distro.change)}
                <span>(${formatPercent(distro.changePct)})</span>
              </td>
              <td class="momentum ${trendClass}">${trendIcon} ${formatSigned(distro.trend)} <span>vs. last month</span></td>
            </tr>
          `;
        })
        .join('');
    }

    function getFilteredDistros() {
      const filter = state.filter.trim().toLowerCase();
      const list = state.distros
        .filter(distro => distro.name.toLowerCase().includes(filter));

      list.sort((a, b) => {
        const key = state.sortKey;
        const delta = b[key] - a[key];
        return delta !== 0 ? delta : a.name.localeCompare(b.name);
      });

      return list;
    }

    function setSelected(name) {
      const distro = state.distros.find(item => item.name === name);
      state.selected = distro || null;
      renderTable();
      renderDetail();
    }

    function renderDetail() {
      if (!state.selected) {
        detailMetricsEl.hidden = true;
        chartContainerEl.hidden = true;
        detailNameEl.textContent = 'Select a distribution';
        detailDescriptionEl.textContent = 'Choose a distro from the table to inspect page-hit momentum month-by-month.';
        chartEl.innerHTML = '';
        return;
      }

      const distro = state.selected;
      detailNameEl.textContent = distro.name;
      detailDescriptionEl.textContent = 'Page-hit activity measured by DistroWatch from Jan 1 – Oct 18, 2025.';
      detailMetricsEl.hidden = false;
      chartContainerEl.hidden = false;

      detailAverageEl.textContent = formatNumber(distro.avgHits);
      detailAverageNoteEl.textContent = 'Average daily page hits';
      detailLatestEl.textContent = formatNumber(distro.lastHits);
      detailLatestNoteEl.textContent = `in ${state.months[state.months.length - 1]}`;

      const changeLabel = `${formatSigned(distro.change)} (${formatPercent(distro.changePct)})`;
      detailChangeEl.textContent = changeLabel;
      detailChangeNoteEl.textContent = `since ${state.months[0]}`;

      chartRangeEl.textContent = `${state.months[0]} – ${state.months[state.months.length - 1]}`;
      renderChart(distro.points);
    }

    function renderChart(points) {
      const width = 360;
      const height = 220;
      const paddingX = 44;
      const paddingY = 36;
      const baseY = height - paddingY;
      const hits = points.map(point => point.hits);
      const max = Math.max(...hits);
      const min = Math.min(...hits);
      const verticalRange = max === min ? 1 : max - min;
      const xStep = points.length > 1 ? (width - paddingX * 2) / (points.length - 1) : 0;

      const getX = index => paddingX + index * xStep;
      const getY = value => {
        const normalized = (value - min) / verticalRange;
        const inverted = 1 - normalized;
        return paddingY + inverted * (height - paddingY * 2);
      };

      const path = points
        .map((point, index) => `${index === 0 ? 'M' : 'L'} ${getX(index).toFixed(2)} ${getY(point.hits).toFixed(2)}`)
        .join(' ');

      const areaPath = `${path} L ${getX(points.length - 1).toFixed(2)} ${baseY} L ${getX(0).toFixed(2)} ${baseY} Z`;

      const yTicks = [...new Set([max, Math.round((max + min) / 2), min])].sort((a, b) => b - a);

      const yTickMarkup = yTicks
        .map(value => {
          const y = getY(value);
          return `
            <g>
              <line class="grid-line" x1="${paddingX}" y1="${y.toFixed(2)}" x2="${width - paddingX}" y2="${y.toFixed(2)}"></line>
              <text class="tick-label" x="${paddingX - 12}" y="${(y + 4).toFixed(2)}" text-anchor="end">${Math.round(value).toLocaleString()}</text>
            </g>
          `;
        })
        .join('');

      const monthLabels = points
        .map((point, index) => {
          const label = point.label.split(' ')[0];
          return `<text class="tick-label" x="${getX(index).toFixed(2)}" y="${(baseY + 20).toFixed(2)}" text-anchor="middle">${label}</text>`;
        })
        .join('');

      const pointsMarkup = points
        .map((point, index) => `<circle cx="${getX(index).toFixed(2)}" cy="${getY(point.hits).toFixed(2)}" r="4"></circle>`)
        .join('');

      chartEl.setAttribute('viewBox', `0 0 ${width} ${height}`);
      chartEl.innerHTML = `
        <defs>
          <linearGradient id="lineGradient" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="#2563eb" stop-opacity="0.85"></stop>
            <stop offset="100%" stop-color="#2563eb" stop-opacity="0.08"></stop>
          </linearGradient>
        </defs>
        <line class="axis" x1="${paddingX}" y1="${baseY}" x2="${width - paddingX}" y2="${baseY}"></line>
        ${yTickMarkup}
        <path class="trend-area" d="${areaPath}"></path>
        <path class="trend-line" d="${path}"></path>
        ${pointsMarkup}
        ${monthLabels}
      `;
    }

    function formatNumber(value) {
      return Math.round(value).toLocaleString();
    }

    function formatPercent(value) {
      const sign = value > 0 ? '+' : value < 0 ? '-' : '';
      const absolute = Math.abs(value).toFixed(1);
      return `${sign}${absolute}%`;
    }

    function formatSigned(value) {
      const sign = value > 0 ? '+' : value < 0 ? '-' : '';
      return `${sign}${Math.abs(Math.round(value)).toLocaleString()}`;
    }

    searchEl.addEventListener('input', event => {
      state.filter = event.currentTarget.value;
      renderTable();
      const first = getFilteredDistros()[0];
      if (first) {
        setSelected(first.name);
      } else {
        setSelected(null);
      }
    });

    sortEl.addEventListener('change', event => {
      state.sortKey = event.currentTarget.value;
      renderTable();
    });

    tableBodyEl.addEventListener('click', event => {
      const row = event.target.closest('tr[data-name]');
      if (!row) return;
      setSelected(row.dataset.name);
    });
  </script>
</body>
</html>
